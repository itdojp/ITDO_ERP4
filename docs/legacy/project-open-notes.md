# Project-Open 利用機能とカスタマイズ要点（ドラフト）

## 1. タイムシート機能
- **利用範囲**: `/intranet-timesheet2/hours/` 配下の画面で日次・週次の工数入力、月次集計、プロジェクト別レポートを運用。  
- **入力内容**: プロジェクト／タスク選択、作業区分（通常・残業など）、作業内容テキスト、在宅／客先などの勤務場所を利用。  
- **承認フロー**: `intranet-timesheet2-workflow` の二段階承認（上長→PM）を採用。差戻し・再申請を頻繁に利用している。  
- **カスタマイズ要点**: 入力画面に自社用の説明文・プレースホルダーを追加、週次表示のデフォルト期間を調整している。新システムも「日次・週次入力」「二段階承認」「差戻し履歴」を提供する必要がある。  
- **連携**: タイムシート承認済みデータを原価計算・請求処理の基礎データとして利用している（後述の請求モジュールと密結合）。

## 2. 勤怠・休暇連携
- **利用範囲**: `intranet-timesheet2/www/absences/` の休暇申請画面を使用し、年次有給残数の参照や休暇入力を実施。  
- **カスタマイズ要点**: 休暇残数の計算ロジックを自社制度に合わせて調整（申請フォームの表示文言、休暇区分の選択肢を日本語化）。  
- **要件**: 新システムでも勤怠データから休暇残数・申請状況を確認できること、タイムシート入力と矛盾がないようにバリデーションすること。

## 3. 請求・単価管理
- **利用範囲**: `intranet-timesheet2-invoices` による工数ベース請求を主に使用。プロジェクトごとの単価設定や価格表アップロード機能（CSV）を業務で活用。  
- **カスタマイズ要点**: `price-lists` フローに自社テンプレートを追加し、時間単価の初期値やバリデーションメッセージを日本語化。`intranet-invoices/www/view.tcl` の日付フォーマットを `"%x"`→`"%F"` に変更し、請求書上の日付を ISO 形式（YYYY-MM-DD）で表示するよう調整。  
- **帳票**: `intranet-invoices-templates/vaw/` のテンプレートをベースに、自社ロゴ・印影・インボイス番号などを組み込んだレイアウトを作成済み（詳細は社内管理のExcel資料に記載、リポジトリ非掲載）。  
- **要件**: 新システムでは工数承認済みデータからの請求書生成、単価管理（標準／特別単価）とCSVインポート、テンプレートベースの帳票生成が必須。

## 4. 日報・通知運用
- **利用範囲**: `/intranet-timesheet2/hours/` から日報メールを送信し、チーム共有に活用。本文フォーマットは「作業概要／成果／懸案」を箇条書きで整形する既存 SQL を利用。  
- **カスタマイズ要点**: メール件名や本文見出しを日本語化し、複数プロジェクトの工数をまとめて送れるよう整形ロジックを変更。`acs-mail-procs.tcl` / `acs-mail-init.tcl` を調整し、送信ジョブのパッケージ ID 指定や運用パラメータを固定。平日朝 8:30 に `check_reminder.sh` を cron 実行し、未入力者に日報登録を促すリマインダーメールを自動送信。  
- **要件**: 新システムでは同様のフォーマットでメールまたはチャット通知を送れること、件名・本文テンプレートを管理画面から調整できること。加えて、リマインダー運用を容易に設定できるスケジューラ機能が望ましい。

## 5. プロジェクト管理
- **利用範囲**: `intranet-core/www/projects/` の新規作成・テンプレート複製機能を多用。プロジェクト階層（親子構造）と WBS 管理をタイムシートと連動させている。  
- **カスタマイズ要点**: プロジェクト登録フォームに社内区分・顧客コードなど独自項目を追加。テンプレートを業種別に複製する仕組みを Tcl で拡張。  
- **要件**: 新システムでもプロジェクト階層管理、テンプレート複製、タイムシートとのID連携が必要。

## 6. 権限・ユーザ管理
- **利用範囲**: Project-Open 標準の Site-Wide Administrators ロールを基点に、PM／一般社員／経理担当などを組み合わせて運用。  
- **カスタマイズ要点**: `membership_rel__new` を使った初期ロール付与のスクリプトを整備済み。画面ごとのアクセス制御は `acs_permission` をベースに調整。  
- **要件**: 新システムではロールベースアクセス制御（RBAC）を実装し、プロジェクト単位の閲覧制限や承認権限を柔軟に設定できるようにする。

## 7. レポート／エクスポート
- **利用範囲**: `intranet-timesheet2/www/reports/` の月次詳細、リソース別集計、週次レポートをPDF/CSVでダウンロードしている。  
- **カスタマイズ要点**: 出力項目を日本語化し、CSVのカラム順を社内標準Excelに合わせて変更。  
- **要件**: 新システムでもプロジェクト別／個人別の集計レポートを即時出力できること、フォーマットを調整可能な仕組みが必要。

---
上記は利用中の機能とカスタマイズ箇所の現状把握メモであり、今後の棚卸し結果に応じて追記・更新していく。
