# Performance results (2026-01-17)


## Run: baseline

- commit: 84a6ca657758e0f6fc76e692e43db5cea273f77f
- db: podman (erp4-pg-perf)
- tools: node v22.19.0, podman 4.9.3, autocannon@8.0.0
- endpoints: /projects, /reports/project-profit, /reports/project-profit/by-user

### Setup
- DB reset log: `tmp/perf-db-reset.log`

== DB reset ==
ok

== Perf seed ==
ok

== Dataset counts ==
- timeEntries(perf-user): 50000
- expenses(perf-user): 5000
- rateCards(role=perf): 16000

== Build backend ==
ok

== Start backend ==

== pg_stat_statements reset ==
postgres ready: erp4-pg-perf
CREATE EXTENSION
 pg_stat_statements_reset 
--------------------------
 
(1 row)


== Bench ==

### GET /projects
```
Running 20s test @ http://localhost:3003/projects
10 connections


┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 2 ms │ 3 ms │ 5 ms  │ 6 ms │ 2.71 ms │ 1.27 ms │ 91 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼────────┼─────────┤
│ Req/Sec   │ 2,081   │ 2,081   │ 3,185   │ 3,295   │ 3,107.7 │ 269.63 │ 2,081   │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼────────┼─────────┤
│ Bytes/Sec │ 3.61 MB │ 3.61 MB │ 5.53 MB │ 5.72 MB │ 5.39 MB │ 468 kB │ 3.61 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 20

62k requests in 20.02s, 108 MB read
```

### GET /reports/project-profit/:projectId
```
Running 20s test @ http://localhost:3003/reports/project-profit/00000000-0000-0000-0000-000000000001
10 connections


┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬──────────┬─────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev    │ Max     │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼──────────┼─────────┤
│ Latency │ 1784 ms │ 1866 ms │ 2108 ms │ 2112 ms │ 1877.56 ms │ 82.39 ms │ 2112 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴──────────┴─────────┘
┌───────────┬─────┬──────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%  │ 2.5% │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 0   │ 0    │ 2       │ 10      │ 5       │ 4.84    │ 2       │
├───────────┼─────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 2.33 kB │ 11.7 kB │ 5.83 kB │ 5.64 kB │ 2.33 kB │
└───────────┴─────┴──────┴─────────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 20

110 requests in 20.04s, 117 kB read
```

### GET /reports/project-profit/:projectId/by-user
```
Running 20s test @ http://localhost:3003/reports/project-profit/00000000-0000-0000-0000-000000000001/by-user
10 connections


┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬───────────┬─────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max     │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼───────────┼─────────┤
│ Latency │ 1518 ms │ 1920 ms │ 2429 ms │ 2461 ms │ 1953.39 ms │ 226.22 ms │ 2492 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴───────────┴─────────┘
┌───────────┬─────┬──────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%  │ 2.5% │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 0   │ 0    │ 1       │ 10      │ 5       │ 4.91    │ 1       │
├───────────┼─────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 1.58 kB │ 15.8 kB │ 7.88 kB │ 7.74 kB │ 1.58 kB │
└───────────┴─────┴──────┴─────────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 20

110 requests in 20.03s, 158 kB read
```


== pg_stat_statements ==
postgres ready: erp4-pg-perf
CREATE EXTENSION
== pg_stat_statements status ==
 shared_preload_libraries 
--------------------------
 pg_stat_statements
(1 row)

 pg_stat_installed 
-------------------
                 1
(1 row)

== Top queries by total_exec_time ==
 calls |   total_exec_time   |    mean_exec_time    |  rows   |                                                                                                                                                                                                                                                                                                                                                                                               query                                                                                                                                                                                                                                                                                                                                                                                                
-------+---------------------+----------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 39600 |   95912.00434700072 |   2.4220203117929255 | 1980000 | SELECT "public"."RateCard"."id", "public"."RateCard"."projectId", "public"."RateCard"."role", "public"."RateCard"."workType", "public"."RateCard"."unitPrice", "public"."RateCard"."validFrom", "public"."RateCard"."validTo", "public"."RateCard"."currency" FROM "public"."RateCard" WHERE ("public"."RateCard"."validFrom" <= $1 AND ("public"."RateCard"."validTo" IS NULL OR "public"."RateCard"."validTo" >= $2) AND (("public"."RateCard"."projectId" = $3 AND "public"."RateCard"."workType" IS NULL) OR ("public"."RateCard"."projectId" IS NULL AND "public"."RateCard"."workType" IS NULL))) ORDER BY "public"."RateCard"."validFrom" DESC LIMIT $4 OFFSET $5
   110 |   4859.458460000001 |   44.176895090909106 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
   110 |  3653.6290090000007 |    33.21480917272728 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."userId", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
 62150 |   1115.024932000004 |  0.01794086777152067 |  124300 | SELECT "public"."Project"."id", "public"."Project"."code", "public"."Project"."name", "public"."Project"."status"::text, "public"."Project"."projectType", "public"."Project"."parentId", "public"."Project"."customerId", "public"."Project"."ownerUserId", "public"."Project"."orgUnitId", "public"."Project"."startDate", "public"."Project"."endDate", "public"."Project"."currency", "public"."Project"."planHours", "public"."Project"."budgetCost", "public"."Project"."createdAt", "public"."Project"."createdBy", "public"."Project"."updatedAt", "public"."Project"."updatedBy", "public"."Project"."deletedAt", "public"."Project"."deletedReason" FROM "public"."Project" WHERE "public"."Project"."deletedAt" IS NULL ORDER BY "public"."Project"."createdAt" DESC LIMIT $1 OFFSET $2
   110 |  250.92016900000007 |   2.2810924454545454 |     220 | SELECT SUM("public"."Expense"."amount"), "public"."Expense"."userId" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) GROUP BY "public"."Expense"."userId" OFFSET $3
   110 |  195.97215999999997 |   1.7815650909090912 |     110 | SELECT SUM("amount") FROM (SELECT "public"."Expense"."amount" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) OFFSET $3) AS "sub"
   220 |   6.804224999999997 | 0.030928295454545434 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."Invoice"."totalAmount" FROM "public"."Invoice" WHERE ("public"."Invoice"."projectId" = $1 AND "public"."Invoice"."deletedAt" IS NULL AND "public"."Invoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
   220 |   4.960664999999998 |  0.02254847727272726 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."VendorInvoice"."totalAmount" FROM "public"."VendorInvoice" WHERE ("public"."VendorInvoice"."projectId" = $1 AND "public"."VendorInvoice"."deletedAt" IS NULL AND "public"."VendorInvoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
   110 |   4.332083000000001 |  0.03938257272727274 |     110 | SELECT "public"."Estimate"."id", "public"."Estimate"."totalAmount" FROM "public"."Estimate" WHERE ("public"."Estimate"."projectId" = $1 AND "public"."Estimate"."deletedAt" IS NULL AND "public"."Estimate"."status" = CAST($2::text AS "public"."DocStatus")) ORDER BY "public"."Estimate"."createdAt" DESC LIMIT $3 OFFSET $4
   220 |  3.2137909999999996 | 0.014608140909090907 |     220 | SELECT "public"."Project"."id", "public"."Project"."currency" FROM "public"."Project" WHERE ("public"."Project"."id" = $1 AND $4=$5) LIMIT $2 OFFSET $3
    53 | 0.24892199999999995 |  0.00469664150943396 |      53 | SELECT $1
     1 |            0.171168 |             0.171168 |       1 | SELECT pg_stat_statements_reset()
     1 |            0.131354 |             0.131354 |       0 | CREATE EXTENSION IF NOT EXISTS pg_stat_statements
     2 |              0.0323 |              0.01615 |       2 | SELECT count(*) AS pg_stat_installed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +
       |                     |                      |         | FROM pg_extension                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +
       |                     |                      |         | WHERE extname = $1
     1 |            0.011722 |             0.011722 |       1 | SELECT current_setting($1) AS shared_preload_libraries
     1 |            0.006813 |             0.006813 |       0 | SHOW shared_preload_libraries
(16 rows)

== Top queries by mean_exec_time ==
 calls |   total_exec_time   |    mean_exec_time    |  rows   |                                                                                                                                                                                                                                                                                                                                                                                               query                                                                                                                                                                                                                                                                                                                                                                                                
-------+---------------------+----------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   110 |   4859.458460000001 |   44.176895090909106 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
   110 |  3653.6290090000007 |    33.21480917272728 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."userId", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
 39600 |   95912.00434700072 |   2.4220203117929255 | 1980000 | SELECT "public"."RateCard"."id", "public"."RateCard"."projectId", "public"."RateCard"."role", "public"."RateCard"."workType", "public"."RateCard"."unitPrice", "public"."RateCard"."validFrom", "public"."RateCard"."validTo", "public"."RateCard"."currency" FROM "public"."RateCard" WHERE ("public"."RateCard"."validFrom" <= $1 AND ("public"."RateCard"."validTo" IS NULL OR "public"."RateCard"."validTo" >= $2) AND (("public"."RateCard"."projectId" = $3 AND "public"."RateCard"."workType" IS NULL) OR ("public"."RateCard"."projectId" IS NULL AND "public"."RateCard"."workType" IS NULL))) ORDER BY "public"."RateCard"."validFrom" DESC LIMIT $4 OFFSET $5
   110 |  250.92016900000007 |   2.2810924454545454 |     220 | SELECT SUM("public"."Expense"."amount"), "public"."Expense"."userId" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) GROUP BY "public"."Expense"."userId" OFFSET $3
   110 |  195.97215999999997 |   1.7815650909090912 |     110 | SELECT SUM("amount") FROM (SELECT "public"."Expense"."amount" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) OFFSET $3) AS "sub"
     1 |            0.171168 |             0.171168 |       1 | SELECT pg_stat_statements_reset()
     1 |            0.162532 |             0.162532 |      16 | SELECT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +
       |                     |                      |         |   calls,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +
       |                     |                      |         |   total_exec_time,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
       |                     |                      |         |   mean_exec_time,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +
       |                     |                      |         |   rows,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +
       |                     |                      |         |   query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +
       |                     |                      |         | FROM pg_stat_statements                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +
       |                     |                      |         | ORDER BY total_exec_time DESC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +
       |                     |                      |         | LIMIT $1
     1 |            0.131354 |             0.131354 |       0 | CREATE EXTENSION IF NOT EXISTS pg_stat_statements
   110 |   4.332083000000001 |  0.03938257272727274 |     110 | SELECT "public"."Estimate"."id", "public"."Estimate"."totalAmount" FROM "public"."Estimate" WHERE ("public"."Estimate"."projectId" = $1 AND "public"."Estimate"."deletedAt" IS NULL AND "public"."Estimate"."status" = CAST($2::text AS "public"."DocStatus")) ORDER BY "public"."Estimate"."createdAt" DESC LIMIT $3 OFFSET $4
   220 |   6.804224999999997 | 0.030928295454545434 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."Invoice"."totalAmount" FROM "public"."Invoice" WHERE ("public"."Invoice"."projectId" = $1 AND "public"."Invoice"."deletedAt" IS NULL AND "public"."Invoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
   220 |   4.960664999999998 |  0.02254847727272726 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."VendorInvoice"."totalAmount" FROM "public"."VendorInvoice" WHERE ("public"."VendorInvoice"."projectId" = $1 AND "public"."VendorInvoice"."deletedAt" IS NULL AND "public"."VendorInvoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
 62150 |   1115.024932000004 |  0.01794086777152067 |  124300 | SELECT "public"."Project"."id", "public"."Project"."code", "public"."Project"."name", "public"."Project"."status"::text, "public"."Project"."projectType", "public"."Project"."parentId", "public"."Project"."customerId", "public"."Project"."ownerUserId", "public"."Project"."orgUnitId", "public"."Project"."startDate", "public"."Project"."endDate", "public"."Project"."currency", "public"."Project"."planHours", "public"."Project"."budgetCost", "public"."Project"."createdAt", "public"."Project"."createdBy", "public"."Project"."updatedAt", "public"."Project"."updatedBy", "public"."Project"."deletedAt", "public"."Project"."deletedReason" FROM "public"."Project" WHERE "public"."Project"."deletedAt" IS NULL ORDER BY "public"."Project"."createdAt" DESC LIMIT $1 OFFSET $2
     2 |              0.0323 |              0.01615 |       2 | SELECT count(*) AS pg_stat_installed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +
       |                     |                      |         | FROM pg_extension                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +
       |                     |                      |         | WHERE extname = $1
   220 |  3.2137909999999996 | 0.014608140909090907 |     220 | SELECT "public"."Project"."id", "public"."Project"."currency" FROM "public"."Project" WHERE ("public"."Project"."id" = $1 AND $4=$5) LIMIT $2 OFFSET $3
     1 |            0.011722 |             0.011722 |       1 | SELECT current_setting($1) AS shared_preload_libraries
     1 |            0.006813 |             0.006813 |       0 | SHOW shared_preload_libraries
    53 | 0.24892199999999995 |  0.00469664150943396 |      53 | SELECT $1
(17 rows)


backend log: /home/devuser/work/CodeX/ITDO_ERP4/tmp/perf-backend.log

## Run: after-ratecard-index

- commit: 6dbb5be16381d6d56fadabf68f02e9ce4ab93294
- db: podman (erp4-pg-perf)
- tools: node v22.19.0, podman 4.9.3, autocannon@8.0.0
- endpoints: /projects, /reports/project-profit, /reports/project-profit/by-user

### Setup
- DB reset log: `tmp/perf-db-reset.log`

== DB reset ==
ok

== Perf seed ==
ok

== Dataset counts ==
- timeEntries(perf-user): 50000
- expenses(perf-user): 5000
- rateCards(role=perf): 16000

== Build backend ==
ok

== Start backend ==

== pg_stat_statements reset ==
postgres ready: erp4-pg-perf
CREATE EXTENSION
 pg_stat_statements_reset 
--------------------------
 
(1 row)


== Bench ==

### GET /projects
```
Running 20s test @ http://localhost:3003/projects
10 connections


┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 2 ms │ 2 ms │ 5 ms  │ 6 ms │ 2.64 ms │ 1.22 ms │ 73 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 1,948   │ 1,948   │ 3,243   │ 3,525   │ 3,163.85 │ 327.41 │ 1,948   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 3.38 MB │ 3.38 MB │ 5.63 MB │ 6.12 MB │ 5.49 MB  │ 568 kB │ 3.38 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 20

63k requests in 20.02s, 110 MB read
```

### GET /reports/project-profit/:projectId
```
Running 20s test @ http://localhost:3003/reports/project-profit/00000000-0000-0000-0000-000000000001
10 connections


┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬───────────┬─────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max     │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼───────────┼─────────┤
│ Latency │ 1768 ms │ 1811 ms │ 2135 ms │ 2135 ms │ 1847.72 ms │ 102.64 ms │ 2136 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴───────────┴─────────┘
┌───────────┬─────┬──────┬─────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%  │ 2.5% │ 50% │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────┼──────┼─────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 0   │ 0    │ 0   │ 10      │ 5       │ 5       │ 10      │
├───────────┼─────┼──────┼─────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 0 B │ 11.7 kB │ 5.83 kB │ 5.83 kB │ 11.7 kB │
└───────────┴─────┴──────┴─────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 20

110 requests in 20.04s, 117 kB read
```

### GET /reports/project-profit/:projectId/by-user
```
Running 20s test @ http://localhost:3003/reports/project-profit/00000000-0000-0000-0000-000000000001/by-user
10 connections


┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬───────────┬─────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max     │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼───────────┼─────────┤
│ Latency │ 1499 ms │ 1888 ms │ 2440 ms │ 2477 ms │ 1949.26 ms │ 260.08 ms │ 2481 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴───────────┴─────────┘
┌───────────┬─────┬──────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%  │ 2.5% │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 0   │ 0    │ 1       │ 10      │ 5       │ 4.82    │ 1       │
├───────────┼─────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 1.58 kB │ 15.8 kB │ 7.88 kB │ 7.59 kB │ 1.58 kB │
└───────────┴─────┴──────┴─────────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 20

110 requests in 20.04s, 158 kB read
```


== pg_stat_statements ==
postgres ready: erp4-pg-perf
CREATE EXTENSION
== pg_stat_statements status ==
 shared_preload_libraries 
--------------------------
 pg_stat_statements
(1 row)

 pg_stat_installed 
-------------------
                 1
(1 row)

== Top queries by total_exec_time ==
 calls |   total_exec_time    |    mean_exec_time     |  rows   |                                                                                                                                                                                                                                                                                                                                                                                               query                                                                                                                                                                                                                                                                                                                                                                                                
-------+----------------------+-----------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 39600 |    75414.15130200011 |    1.9043977601515134 | 1980000 | SELECT "public"."RateCard"."id", "public"."RateCard"."projectId", "public"."RateCard"."role", "public"."RateCard"."workType", "public"."RateCard"."unitPrice", "public"."RateCard"."validFrom", "public"."RateCard"."validTo", "public"."RateCard"."currency" FROM "public"."RateCard" WHERE ("public"."RateCard"."validFrom" <= $1 AND ("public"."RateCard"."validTo" IS NULL OR "public"."RateCard"."validTo" >= $2) AND (("public"."RateCard"."projectId" = $3 AND "public"."RateCard"."workType" IS NULL) OR ("public"."RateCard"."projectId" IS NULL AND "public"."RateCard"."workType" IS NULL))) ORDER BY "public"."RateCard"."validFrom" DESC LIMIT $4 OFFSET $5
   110 |    4836.391700000001 |     43.96719727272726 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
   110 |   3800.7611909999996 |     34.55237446363638 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."userId", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
 63273 |   1147.8178350000042 |  0.018140720923616637 |  126546 | SELECT "public"."Project"."id", "public"."Project"."code", "public"."Project"."name", "public"."Project"."status"::text, "public"."Project"."projectType", "public"."Project"."parentId", "public"."Project"."customerId", "public"."Project"."ownerUserId", "public"."Project"."orgUnitId", "public"."Project"."startDate", "public"."Project"."endDate", "public"."Project"."currency", "public"."Project"."planHours", "public"."Project"."budgetCost", "public"."Project"."createdAt", "public"."Project"."createdBy", "public"."Project"."updatedAt", "public"."Project"."updatedBy", "public"."Project"."deletedAt", "public"."Project"."deletedReason" FROM "public"."Project" WHERE "public"."Project"."deletedAt" IS NULL ORDER BY "public"."Project"."createdAt" DESC LIMIT $1 OFFSET $2
   110 |   245.65514300000004 |    2.2332285727272736 |     220 | SELECT SUM("public"."Expense"."amount"), "public"."Expense"."userId" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) GROUP BY "public"."Expense"."userId" OFFSET $3
   110 |   192.77453200000005 |     1.752495745454545 |     110 | SELECT SUM("amount") FROM (SELECT "public"."Expense"."amount" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) OFFSET $3) AS "sub"
   220 |   4.9104309999999955 |  0.022320140909090905 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."Invoice"."totalAmount" FROM "public"."Invoice" WHERE ("public"."Invoice"."projectId" = $1 AND "public"."Invoice"."deletedAt" IS NULL AND "public"."Invoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
   220 |    4.597996000000002 |   0.02089998181818181 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."VendorInvoice"."totalAmount" FROM "public"."VendorInvoice" WHERE ("public"."VendorInvoice"."projectId" = $1 AND "public"."VendorInvoice"."deletedAt" IS NULL AND "public"."VendorInvoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
   110 |   3.7275710000000015 |  0.033887009090909075 |     110 | SELECT "public"."Estimate"."id", "public"."Estimate"."totalAmount" FROM "public"."Estimate" WHERE ("public"."Estimate"."projectId" = $1 AND "public"."Estimate"."deletedAt" IS NULL AND "public"."Estimate"."status" = CAST($2::text AS "public"."DocStatus")) ORDER BY "public"."Estimate"."createdAt" DESC LIMIT $3 OFFSET $4
   220 |   2.8603080000000007 |  0.013001400000000007 |     220 | SELECT "public"."Project"."id", "public"."Project"."currency" FROM "public"."Project" WHERE ("public"."Project"."id" = $1 AND $4=$5) LIMIT $2 OFFSET $3
    54 |              0.23832 | 0.0044133333333333325 |      54 | SELECT $1
     1 |  0.17960299999999998 |   0.17960299999999998 |       1 | SELECT pg_stat_statements_reset()
     1 |             0.173522 |              0.173522 |       0 | CREATE EXTENSION IF NOT EXISTS pg_stat_statements
     1 |             0.038531 |              0.038531 |       0 | SHOW shared_preload_libraries
     2 | 0.019125999999999997 |  0.009562999999999999 |       2 | SELECT count(*) AS pg_stat_installed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +
       |                      |                       |         | FROM pg_extension                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +
       |                      |                       |         | WHERE extname = $1
     1 |             0.012293 |              0.012293 |       1 | SELECT current_setting($1) AS shared_preload_libraries
(16 rows)

== Top queries by mean_exec_time ==
 calls |   total_exec_time    |    mean_exec_time     |  rows   |                                                                                                                                                                                                                                                                                                                                                                                               query                                                                                                                                                                                                                                                                                                                                                                                                
-------+----------------------+-----------------------+---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   110 |    4836.391700000001 |     43.96719727272726 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
   110 |   3800.7611909999996 |     34.55237446363638 | 5500110 | SELECT "public"."TimeEntry"."id", "public"."TimeEntry"."userId", "public"."TimeEntry"."minutes", "public"."TimeEntry"."workDate", "public"."TimeEntry"."workType" FROM "public"."TimeEntry" WHERE ("public"."TimeEntry"."projectId" = $1 AND "public"."TimeEntry"."deletedAt" IS NULL AND "public"."TimeEntry"."status" IN (CAST($2::text AS "public"."TimeStatus"),CAST($3::text AS "public"."TimeStatus"))) OFFSET $4
   110 |   245.65514300000004 |    2.2332285727272736 |     220 | SELECT SUM("public"."Expense"."amount"), "public"."Expense"."userId" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) GROUP BY "public"."Expense"."userId" OFFSET $3
 39600 |    75414.15130200011 |    1.9043977601515134 | 1980000 | SELECT "public"."RateCard"."id", "public"."RateCard"."projectId", "public"."RateCard"."role", "public"."RateCard"."workType", "public"."RateCard"."unitPrice", "public"."RateCard"."validFrom", "public"."RateCard"."validTo", "public"."RateCard"."currency" FROM "public"."RateCard" WHERE ("public"."RateCard"."validFrom" <= $1 AND ("public"."RateCard"."validTo" IS NULL OR "public"."RateCard"."validTo" >= $2) AND (("public"."RateCard"."projectId" = $3 AND "public"."RateCard"."workType" IS NULL) OR ("public"."RateCard"."projectId" IS NULL AND "public"."RateCard"."workType" IS NULL))) ORDER BY "public"."RateCard"."validFrom" DESC LIMIT $4 OFFSET $5
   110 |   192.77453200000005 |     1.752495745454545 |     110 | SELECT SUM("amount") FROM (SELECT "public"."Expense"."amount" FROM "public"."Expense" WHERE ("public"."Expense"."projectId" = $1 AND "public"."Expense"."deletedAt" IS NULL AND "public"."Expense"."status" = CAST($2::text AS "public"."DocStatus")) OFFSET $3) AS "sub"
     1 |  0.17960299999999998 |   0.17960299999999998 |       1 | SELECT pg_stat_statements_reset()
     1 |             0.173522 |              0.173522 |       0 | CREATE EXTENSION IF NOT EXISTS pg_stat_statements
     1 |             0.135863 |              0.135863 |      16 | SELECT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +
       |                      |                       |         |   calls,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +
       |                      |                       |         |   total_exec_time,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
       |                      |                       |         |   mean_exec_time,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +
       |                      |                       |         |   rows,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +
       |                      |                       |         |   query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +
       |                      |                       |         | FROM pg_stat_statements                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +
       |                      |                       |         | ORDER BY total_exec_time DESC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +
       |                      |                       |         | LIMIT $1
     1 |             0.038531 |              0.038531 |       0 | SHOW shared_preload_libraries
   110 |   3.7275710000000015 |  0.033887009090909075 |     110 | SELECT "public"."Estimate"."id", "public"."Estimate"."totalAmount" FROM "public"."Estimate" WHERE ("public"."Estimate"."projectId" = $1 AND "public"."Estimate"."deletedAt" IS NULL AND "public"."Estimate"."status" = CAST($2::text AS "public"."DocStatus")) ORDER BY "public"."Estimate"."createdAt" DESC LIMIT $3 OFFSET $4
   220 |   4.9104309999999955 |  0.022320140909090905 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."Invoice"."totalAmount" FROM "public"."Invoice" WHERE ("public"."Invoice"."projectId" = $1 AND "public"."Invoice"."deletedAt" IS NULL AND "public"."Invoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
   220 |    4.597996000000002 |   0.02089998181818181 |     220 | SELECT SUM("totalAmount") FROM (SELECT "public"."VendorInvoice"."totalAmount" FROM "public"."VendorInvoice" WHERE ("public"."VendorInvoice"."projectId" = $1 AND "public"."VendorInvoice"."deletedAt" IS NULL AND "public"."VendorInvoice"."status" IN (CAST($2::text AS "public"."DocStatus"),CAST($3::text AS "public"."DocStatus"),CAST($4::text AS "public"."DocStatus"))) OFFSET $5) AS "sub"
 63273 |   1147.8178350000042 |  0.018140720923616637 |  126546 | SELECT "public"."Project"."id", "public"."Project"."code", "public"."Project"."name", "public"."Project"."status"::text, "public"."Project"."projectType", "public"."Project"."parentId", "public"."Project"."customerId", "public"."Project"."ownerUserId", "public"."Project"."orgUnitId", "public"."Project"."startDate", "public"."Project"."endDate", "public"."Project"."currency", "public"."Project"."planHours", "public"."Project"."budgetCost", "public"."Project"."createdAt", "public"."Project"."createdBy", "public"."Project"."updatedAt", "public"."Project"."updatedBy", "public"."Project"."deletedAt", "public"."Project"."deletedReason" FROM "public"."Project" WHERE "public"."Project"."deletedAt" IS NULL ORDER BY "public"."Project"."createdAt" DESC LIMIT $1 OFFSET $2
   220 |   2.8603080000000007 |  0.013001400000000007 |     220 | SELECT "public"."Project"."id", "public"."Project"."currency" FROM "public"."Project" WHERE ("public"."Project"."id" = $1 AND $4=$5) LIMIT $2 OFFSET $3
     1 |             0.012293 |              0.012293 |       1 | SELECT current_setting($1) AS shared_preload_libraries
     2 | 0.019125999999999997 |  0.009562999999999999 |       2 | SELECT count(*) AS pg_stat_installed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +
       |                      |                       |         | FROM pg_extension                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 +
       |                      |                       |         | WHERE extname = $1
    54 |              0.23832 | 0.0044133333333333325 |      54 | SELECT $1
(17 rows)


backend log: /home/devuser/work/CodeX/ITDO_ERP4/tmp/perf-backend.log
