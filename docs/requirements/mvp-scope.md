# MVP 要件サマリー（抜粋版）

ITDO_ERP3 の統合仕様書から、実装フェーズで優先する機能を抜粋・要約したドキュメント。詳細仕様は ITDO_ERP3 の `integrated-specs` を参照しつつ、実装に必要な粒度で更新していく。

## 1. プロジェクト管理（PM）
- **プロジェクト基本情報**: コード、名称、期間、親子構造（最大5階層）、ステータス管理。  
- **WBS/タスク管理**: 依存関係 (FS/SS/FF/SF)、進捗率、バーンダウン、ベースライン。  
- **EVM 指標**: PV・EV・AC・SPI・CPI を日次で算出。  
- **タイムシート連携**: 工数データを FI モジュールへ送出、原価/請求のトレーサビリティを保持。  
- 参考: ITDO_ERP3 `integrated-specs/02-modules/pm-module-spec.md`

## 2. タイムシート＆原価管理（FI）
- **工数入力**: 日次/週次入力、15分粒度、作業内容/残業区分/作業場所などを記録。  
- **承認ワークフロー**: 上長→PM の二段階承認、エスカレーション、再オープン履歴。  
- **単価管理**: 社員×プロジェクト×作業種別単価、割増率設定、履歴管理。  
- **原価集計**: タイムシート×単価＋間接費配賦、プロジェクト原価レポート。  
- 参考: ITDO_ERP3 `integrated-specs/02-modules/fi-module-spec.md`

## 3. 請求・売上管理
- **工数ベース請求**: タイムシート実績に基づく請求書生成、インボイス制度対応。  
- **固定額/マイルストーン請求**: プロジェクトの契約条件に応じた請求スケジュール。  
- **ドキュメント生成**: PDF/HTML 発行、メッセージID重複回避などメール送信の品質担保。  
- 参考: ITDO_ERP3 `integrated-specs/01-core/integration-spec.md`, `docs/projects` ほか

## 4. 通知・連絡
- **日報メール**: `/intranet-timesheet2/hours/` 由来のメールフォーマットを再設計（単一 Message-ID, DKIM/SPF）。  
- **承認・アラート通知**: 承認遅延や不足工数を Slack/メールで自動通知。  
- **監査ログ**: 通知履歴と送信結果を保持し、再送制御を可能にする。

## 5. 認証・権限
- **ロール設計**: Site-Wide Administrators 相当の管理者、PM、従業員、財務担当など。  
- **権限マトリクス**: モジュール×操作（閲覧/入力/承認/管理）を定義し、API/GQL 上で評価。  
- **実施事項**: Project-Open のアサイン（membership_rel__new での登録）を移行し、新権限モデルへマッピング。

## 6. データ移行と互換
- **データマッピング**: Project-Open の `im_*` / `acs_*` テーブル群と Prisma/PostgreSQL 15 スキーマとの整合。  
- **シーケンス管理**: `t_sec_security_token_id_seq` などの不整合を解消し、新環境でも連番整合性を担保。  
- **移行フェーズ**: Phase 0 でマッピング表とクレンジングルールを確定。  
- 参考: ITDO_ERP3 `integrated-specs/04-implementation/migration-plan.md`

## 7. 非機能要件（抜粋）
- **可用性**: 目標 99.9%、フェイルオーバープランを策定。  
- **性能**: タイムシート月10万件の検索/集計に対応。  
- **監査・ログ保全**: PostgreSQL ログの長期保管（例: 30日→90日）や監査証跡の保存。  
- **セキュリティ**: MFA、監査ログ、メール送信時のTLS確保、RBACの徹底。

---
今後、実装に着手しながら、画面仕様・API仕様・テーブル定義などを追記していく。詳細要件の更新は Issue に紐づけて管理する。
