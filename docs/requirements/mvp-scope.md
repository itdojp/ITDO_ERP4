# MVP 要件サマリー（更新版）

ITDO_ERP3 の統合仕様書から、実装フェーズで優先する機能を抜粋・要約したドキュメント。PO からの移行は一方向で行い、著作権に触れないよう注意する。詳細仕様は ITDO_ERP3 の `integrated-specs` を参照しつつ、実装に必要な粒度で更新する。

## 0. スコープと優先度
- **Must（MVPに含める）**
  - 認証/RBAC: Google OIDC + ロール（管理者/PM/一般/経理/人事など）。
  - 見積・請求: 見積→承認→請求書（PDF/メール）、マイルストーン連動、インボイス番号。顧客/業者マスタ必須。
  - プロジェクト: 階層化、タスク管理、マイルストーン、定期保守など繰り返し案件の簡略化。
  - タイムシート: 案件ごとの工数入力（日次/週次）。基本は承認なしで記録し、修正時のみ承認フロー対象（管理部）。
  - 損益/予実: 案件別の損益（人件費+経費/外注費、間接費は除外）、工数予実、期間指定の工数集計（個人/グループ/案件）。
  - 経費精算: 案件経費＋共通経費（期単位の疑似案件で運用）ワークフロー。
  - 休暇申請: 申請/承認フロー。
  - 日報: Webベース（スマホ/PC）入力・閲覧。将来のネイティブアプリを見据えAPI/BFFを設計。
  - HR/ウェルビーイング: 日報等でモチベーションとメンタルヘルスケアの観点を扱う（概要収集を想定）。
- **Should（MVP直後）**
  - 経費UI高度化（領収書添付、承認遅延リマインダ）。
  - タスク依存関係/通知強化、プロジェクトテンプレ管理UI。
  - 予実レポートのカスタム出力、アラート設定UI。
- **Could（後続）**
  - プロジェクト紐付けのグループチャット（タグ付け、絵文字）。
  - スマホネイティブアプリ（Web版APIを再利用）。
  - ID管理連携の高度化（IDaaS連携やMS/Googleアカウントライフサイクル統合）。

- **タイムライン目安**: 生成AIを活用し、2025-12-10 に「動くもの」をステージングに出す。UATを速やかに開始する前提でスコープを固定する。

## 1. プロジェクト管理
- **基本情報**: コード、名称、期間、親子構造（最大5階層想定）、ステータス。
- **階層とタスク**: WBS/タスク管理（依存関係、進捗率、バーンダウン、ベースライン）、プロジェクト内タスク管理。
- **マイルストーン**: 見積・請求と連動するマイルストーン単位の金額/納期管理。定期保守・繰り返し案件のテンプレ化・自動生成。
- **定期案件の扱い**: 毎月/四半期/半年/年次の繰り返し案件はテンプレでデフォルト金額・条件を設定し、起案時に変更できるようにする（特別な例外日設定は初期は不要）。
- **予実/EVM**: PV・EV・AC・SPI・CPI を日次算出し、工数予実に連動。
- **連携**: タイムシート/請求/経費とトレーサブルに紐づけ。
- 参考: ITDO_ERP3 `integrated-specs/02-modules/pm-module-spec.md`

## 2. タイムシート＆原価
- **工数入力**: 案件ごとに日次/週次入力、15分粒度、作業内容/残業区分/作業場所などを記録。
- **承認**: 基本は承認なしで記録し、修正（重要項目変更）のみ承認フロー対象（管理部）。必要なら承認段数を後から拡張できる構造とする。
- **単価管理**: 社員×プロジェクト×作業種別単価、割増率、履歴管理。
- **原価集計**: 人件費＋経費/外注費を原価に含める。間接費は含めず、目標利益率で運用管理。
- 参考: ITDO_ERP3 `integrated-specs/02-modules/fi-module-spec.md`

## 3. 見積・請求・売上管理
- **見積/契約**: 見積の起案→管理部チェック→経営側承認。柔軟に承認段階を設定できること。
- **請求**: タイムシート／マイルストーン連動の請求書生成、インボイス対応。PDF/メール発行、定期案件の自動化。
- **ドキュメント**: メール送信品質（Message-ID等）、テンプレート管理。
- **緩和ルール**: 定期案件や小額は管理部ダブルチェックで経営側承認を省略可。判断つかない場合はエスカレーション。
- 参考: ITDO_ERP3 `integrated-specs/01-core/integration-spec.md` ほか

## 4. 経費・休暇・ワークフロー
- **経費精算**: 案件経費と共通経費（期ごとの疑似案件）で入力・承認。経費は損益に反映。
- **休暇申請**: 申請→承認フロー。タイムシートと矛盾しないバリデーション。
- **見積/請求ワークフロー**: 見積・請求の承認段階（管理部・経営）を柔軟に設定。定期案件/小額での承認スキップ条件は管理画面で金額・条件を設定できるようにし、複数人チェックやグループ内ダブルチェック→別担当が承認といったパターンを構成可能にする。
- **将来拡張**: エスカレーション、承認スキップ条件の管理UIを強化。

## 5. 通知・レポート・アラート
- **日報/通知**: Webベース入力・閲覧。将来ネイティブ化を見据えAPI/BFF設計。Slack連携は低優先。
- **レポート必須**: 月次プロジェクト別工数/予実、グループ別工数、個人別残業。追加レポートを後続で拡張可能に。
- **アラート**: 予算超過、残業増、承認遅延などを通知。閾値・条件・通知先を管理画面で設定可能にする。初期の通知先はメール＋担当者ダッシュボード表示。将来の外部通知（例: Slack）は拡張前提で設計。
- **ウェルビーイング入力**: 日報で Good / Not Good の簡易選択やヘルプボタン等の軽い入力を想定。研究事例を参照しつつプライバシーに配慮した設計（閲覧権限・保管期間）を別途定義する。
- **閲覧権限（ウェルビーイング）**: 閲覧は人事グループのみ。専用グループを作成し人事グループを包含する形で管理する。法的・倫理的要件に合わせ保管期間・同意取得方法を決定する。

## 6. 認証・権限
- **ロール**: 管理者、PM、一般、経理、人事など。プロジェクト/タスク/ワークフロー単位で権限評価。
- **実施事項**: Project-Open のロール・アサインを移行し、新 RBAC へマッピング。MFA/Passkey は Google 依存。
- **ID連携（将来）**: IDaaS や MS/Google アカウント管理との連携を検討。

## 7. データ移行と法的配慮
- **移行方針**: PO から ERP4 への一方向移行。`im_*` / `acs_*` から新スキーマへのマッピングを定義。
- **シーケンス/整合**: 既存の不整合を解消し、新環境で連番整合性を担保。
- **著作権配慮**: PO のライセンスに抵触しないよう、コード/テンプレートの再利用は避け、必要に応じて仕様のみ参照する。
- 参考: ITDO_ERP3 `integrated-specs/04-implementation/migration-plan.md`

## 8. 非機能（抜粋）
- **可用性**: 目標 99.9%、フェイルオーバープラン。
- **性能**: タイムシート月10万件の検索/集計。
- **監査・ログ**: 監査証跡保存、ログ保管期間。レポート/承認/認証の操作履歴を保持。
- **セキュリティ**: TLS、RBAC、監査ログ。メール送信時の品質担保。

---
今後、実装に着手しながら、画面仕様・API仕様・テーブル定義などを追記し、Issue と紐づけて管理する。
