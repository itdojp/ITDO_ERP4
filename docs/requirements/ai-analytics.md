# AI支援/分析モジュール 要件整理（初版）

## 目的

- 収支/工数/予実の可視化と、異常兆候の早期発見を支援する。
- 現場・管理・経営の意思決定に必要な要点を短時間で把握できる状態を作る。

## 想定ユースケース（案）

- 予算超過/残業急増/承認遅延の兆候検知
- 案件別の予実ギャップの要約
- 期間別の粗利・工数の傾向比較
- 定型レポートの要約文（テンプレで開始）

## PoCスコープ（Phase 3）
- ルールベースのインサイト生成（Alertの集計から作成）
- 対象: 予算超過/残業超過/承認遅延/納期未請求/外部連携失敗
- 出力: 管理/経営向けの要約カード（件数・対象・推奨アクション）
- 監査ログで閲覧履歴を記録
## 入力データ範囲（案）

- プロジェクト/見積/請求/経費/工数/承認/アラート
- 予算/単価/RateCard
- 時系列集計（期間/月次）

## 出力先（案）

- ダッシュボード（管理/経営向け）
- レポート（PDF/CSV）
- アラート（メール/ダッシュボード、将来Webhook）

## 権限・匿名化（案）

- HR/ウェルビーイング系は個人特定を避ける（集計のみ）
- 役割別に閲覧可能な指標を制限
- 監査ログで閲覧履歴を追跡

## 非機能/運用（案）

- 誤検知の説明責任（根拠表示）
- 人手レビューの前提（最終判断は人）
- 学習データの扱いと保存範囲
- 根拠表示は件数/期間/計算式/閾値を必須とする（MVP）

## 決定事項（暫定）
- AI利用範囲: ルールベースのインサイト生成 + テンプレ要約まで（予測/分類は後続）。
- 説明可能性: 根拠（対象件数/期間/計算式/閾値）を必須で表示。
- 追加データソース: まずはERP内データのみ（外部CRM/IDaaSは後続）。

## 未決定事項

- なし（MVP方針は上記にて確定）

## PoC API（案）

- `GET /insights`
  - query: `from`, `to`, `projectId`, `limit`
  - response:
    - `generatedAt`: レスポンス生成日時（ISO 8601）
    - `items`: `{ id, type, severity, count, latestAt, sampleTargets, evidence }[]`
      - `evidence`: `{ period, targets, calculation, settings }`
        - `period`: `{ from, to }`（指定がない場合は null）
        - `targets`: 代表対象（ID配列）
        - `calculation`: 根拠/計算式の説明
        - `settings`: `{ id, threshold, period, scopeProjectId }[]`
  - 監査ログ: `insights_view` に filters を記録
  - 備考: `projectId` 指定時は `alert.targetRef` と `alert.setting.scopeProjectId` の一致を含める
## 次アクション

- ユースケースの優先順位を決定
- 必要データの欠損/品質要件を整理
- 画面/APIのI/F草案を作成
- PoC実装（インサイトAPI/表示）
